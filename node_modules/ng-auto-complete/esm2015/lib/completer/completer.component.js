/**
 * @fileoverview added by tsickle
 * @suppress {checkTypes,extraRequire,missingReturn,unusedPrivateMembers,uselessCode} checked by tsc
 */
import * as tslib_1 from "tslib";
import { debounceTime } from 'rxjs/operators';
import { Component, EventEmitter, Input, NgZone, Output, ViewChild, ChangeDetectionStrategy, ChangeDetectorRef } from '@angular/core';
import { AutocompleteGroup } from '../classes/AutocompleteGroup';
import { ComparableAutoCompleteString, SearchableAutoCompleteString } from '../classes/AutocompleteItem';
import { NgDropdownDirective } from '../dropdown/ng-dropdown.directive';
import { Subject } from 'rxjs';
export class CompleterComponent {
    /**
     * @param {?} _zone
     * @param {?} cd
     */
    constructor(_zone, cd) {
        this._zone = _zone;
        this.cd = cd;
        this.cleared = new EventEmitter();
        this.selected = new EventEmitter();
        this.noResult = new EventEmitter();
        this.group = (/** @type {?} */ ({}));
        this._change = new Subject();
        this._items = {};
        this._completer = '';
        this._highlight = '';
        this._disabled = false;
        this._DOM = {
            notFound: (/** @type {?} */ (false)),
            empty: (/** @type {?} */ (false)),
            placeholder: (/** @type {?} */ (null)),
            selected: (/** @type {?} */ ('')),
            isLoading: (/** @type {?} */ (false))
        };
    }
    /**
     *
     * @return {?}
     */
    ngOnInit() {
        this._zone.runOutsideAngular(() => {
            this._change.pipe(debounceTime(300))
                .subscribe((value) => {
                this._zone.run(() => {
                    if (this.group.async !== null) {
                        this.RunAsyncFunction(value);
                    }
                    else {
                        this.OnModelChange(value);
                    }
                    this.cd.detectChanges();
                });
            });
        });
        this.SetItems();
    }
    /**
     * Only used when completion is off.
     * @return {?}
     */
    RegisterClick() {
        if (!this.group.completion) {
            this.SwitchDropdownState();
        }
    }
    /**
     *
     * @return {?}
     */
    DropdownArray() {
        if (this.group.completion) {
            this.SwitchDropdownState();
        }
    }
    /**
     *
     * @return {?}
     */
    SwitchDropdownState() {
        if (this.dropdown._open) {
            this.CloseDropdown();
            return;
        }
        /**
         *
         */
        this.OpenDropdown();
    }
    /**
     *
     * @return {?}
     */
    CloseDropdown() {
        this.dropdown._open = false;
        /**
         *
         */
        this._DOM.placeholder = null;
    }
    /**
     *
     * @return {?}
     */
    OpenDropdown() {
        this.dropdown.Open();
        /**
         *
         */
        this._DOM.placeholder = null;
    }
    /**
     *
     * @return {?}
     */
    SetItems() {
        this._items = this.group.value;
        this.IsInitialEmpty();
    }
    /**
     *
     * @param {?} item
     * @return {?}
     */
    SelectItem(item) {
        /** @type {?} */
        let i;
        if (typeof item === 'string') {
            i = this._items[item];
            this._DOM.selected = item;
        }
        else {
            i = item;
            this._DOM.selected = SearchableAutoCompleteString(item.title, item.id);
        }
        this._completer = i.title;
        this._highlight = '';
        this.dropdown.Close(null, true);
        this.selected.emit({ group: { key: this.group.key }, item: i });
    }
    /**
     *
     * @param {?} value
     * @return {?}
     */
    RunAsyncFunction(value) {
        return tslib_1.__awaiter(this, void 0, void 0, function* () {
            this._completer = value;
            this._highlight = value;
            this._DOM.selected = null;
            if (value.length === 0) {
                this.group.InitialValue();
                this.ClearModel();
                this.dropdown.Close('', true);
            }
            else if (value.length > this.group.searchLength) {
                this._DOM.isLoading = true;
                /** @type {?} */
                const values = yield this.group.async(value);
                this.group.SetNewValue(values, this.group.keys.titleKey);
                this._DOM.isLoading = false;
                this._items = this.group.value;
                this.EmptySearch(this._items, value);
                // User has typed something now, results could be shown. We need to remove the "is-initial-empty" class.
                this.IsInitialEmpty();
                this.dropdown.Open();
            }
            this.cd.detectChanges();
        });
    }
    /**
     *
     * @param {?} value
     * @return {?}
     */
    OnModelChange(value) {
        this._completer = value;
        this._highlight = value;
        this._DOM.selected = null;
        if (value.length === 0) {
            this.ClearModel();
        }
        else if (value.length > this.group.searchLength) {
            this.CompareItemsAndSet(value);
        }
    }
    /**
     *
     * @return {?}
     */
    ClearModel() {
        this._DOM.selected = null;
        this._DOM.notFound = false;
        this.cleared.emit(this.group.key);
    }
    /**
     *
     * @param {?} value
     * @return {?}
     */
    CompareItemsAndSet(value) {
        /** @type {?} */
        const obj = {};
        for (const key in this.group.value) {
            if (ComparableAutoCompleteString(key).toLowerCase().indexOf(value.toLowerCase()) > -1) {
                obj[key] = this.group.value[key];
            }
        }
        this._items = obj;
        this.EmptySearch(this._items, value);
        // User has typed something now, results could be shown. We need to remove the "is-initial-empty" class.
        this.IsInitialEmpty();
        this.dropdown.Open();
    }
    /**
     *
     * @return {?}
     */
    OnInputBlurred() {
        if (!this.HasChosenValue()) {
            /**
             * Let component know completer input has been cleared -
             * this function shows the list again, also resets children, if chosen.
             */
            this.OnModelChange('');
        }
    }
    /**
     *
     * @param {?} item
     * @return {?}
     */
    OnHoverDropdownItem(item) {
        if (typeof item === 'string') {
            this._DOM.placeholder = this._items[item];
            return;
        }
        if (item == null) {
            this._DOM.placeholder = null;
            return;
        }
        this._DOM.placeholder = item;
    }
    // =======================================================================//
    // ! Utils                                                                //
    // =======================================================================//
    /**
     * @return {?}
     */
    IsInitialEmpty() {
        if (Object.keys(this._items).length === 0 && this._completer.length === 0) {
            this._DOM.empty = true;
            return;
        }
        this._DOM.empty = false;
    }
    /**
     *
     * @return {?}
     */
    HasChosenValue() {
        return this._DOM.selected !== null;
    }
    /**
     *
     * @param {?} obj
     * @param {?} query
     * @return {?}
     */
    EmptySearch(obj, query) {
        if (Object.keys(obj).length > 0) {
            this._DOM.notFound = false;
            return;
        }
        this._DOM.notFound = true;
        this.noResult.emit({ group: { key: this.group.key }, query: query });
    }
    /**
     *
     * @return {?}
     */
    ClearValue() {
        this._completer = '';
        this._DOM.selected = null;
        this.group.InitialValue();
        this.IsInitialEmpty();
        /**
         *
         */
        this.selected.emit({ group: { key: this.group.key }, item: null });
    }
}
CompleterComponent.decorators = [
    { type: Component, args: [{
                selector: 'ng-completer',
                template: `
        <div #element class="ng-autocomplete-dropdown"
             [ngClass]="{'open': dropdown._open, 'is-loading': _DOM.isLoading, 'is-async': group.async !== null}">

            <!--GROUP: {{group.key}}-->

            <div class="ng-autocomplete-inputs" (click)="RegisterClick()"
                 [ngClass]="{'completion-off': !group.completion}">
                <span class="ng-autocomplete-placeholder"
                      *ngIf="_DOM.placeholder">
                  <ng-container *ngIf="group.placeholderValue">
                      <ng-template *ngTemplateOutlet="group.placeholderValue; context: {$implicit: _DOM.placeholder}"></ng-template>
                  </ng-container>
                  <ng-template [ngIf]="!group.placeholderValue">
                      {{_DOM.placeholder.title}}
                  </ng-template>
                </span>
                <input #input type="text" [placeholder]="group.placeholder" name="completer" [ngModel]="_completer"
                       (ngModelChange)="_change.next($event);"
                       [value]="_completer"
                       [tabIndex]="_disabled ? -1 : 0"
                       autocomplete="new-password"
                       (focus)="OpenDropdown()" class="ng-autocomplete-input">

                <span [ngClass]="{'open': dropdown._open}" class="ng-autocomplete-dropdown-icon"
                      (click)="DropdownArray()"></span>
            </div>

            <div class="ng-dropdown" ngDropdown [list]="_items" [element]="element" [input]="input"
                 [ngClass]="{'is-initial-empty': _DOM.empty}"
                 [active]="_DOM.selected" [key]="group.key"
                 [completion]="group.completion"
                 [parentDetector]="cd"
                 (hover)="OnHoverDropdownItem($event)"
                 (selected)="SelectItem($event)"
                 (closed)="OnInputBlurred()"
            >
                <div *ngIf="_DOM.notFound && group.noResults" class="dropdown-item no-results">
                    <ng-container *ngIf="group.noResults">
                        <ng-template *ngTemplateOutlet="group.noResults; context: {$implicit: _completer}"></ng-template>
                    </ng-container>
                </div>

                <div class="dropdown-item" *ngFor="let item of _items | keys; let i = index"
                     (click)="SelectItem(_items[item])" [ngClass]="_items[item].className">
                    <ng-container *ngIf="group.dropdownValue">
                        <ng-template
                            *ngTemplateOutlet="group.dropdownValue; context: {$implicit: _items[item], highlight: _items[item].title | highlight:_highlight}"></ng-template>
                    </ng-container>

                    <div *ngIf="!group.dropdownValue" [innerHTML]="_items[item].title | highlight:_highlight"></div>
                </div>
            </div>
        </div>`,
                changeDetection: ChangeDetectionStrategy.OnPush,
                styles: [`
        .ng-autocomplete-inputs {
            position: relative;
        }

        .ng-autocomplete-inputs input[type=text]::-ms-clear,
        .ng-autocomplete-inputs input[type=text]::-ms-reveal {
            display: none;
            width: 0;
            height: 0;
        }

        .ng-autocomplete-inputs.completion-off {
            cursor: pointer;
        }

        .ng-autocomplete-inputs.completion-off input {
            pointer-events: none;
        }

        .ng-autocomplete-placeholder {
            pointer-events: none;
        }

        .ng-autocomplete-dropdown-icon {

        }

        .ng-autocomplete-dropdown .ng-dropdown {
            display: none;
        }

        .ng-autocomplete-dropdown .ng-dropdown.is-empty {
            display: none;
        }

        .ng-autocomplete-dropdown .ng-dropdown.open {
            display: block;
        }
    `]
            }] }
];
/** @nocollapse */
CompleterComponent.ctorParameters = () => [
    { type: NgZone },
    { type: ChangeDetectorRef }
];
CompleterComponent.propDecorators = {
    dropdown: [{ type: ViewChild, args: [NgDropdownDirective,] }],
    cleared: [{ type: Output }],
    selected: [{ type: Output }],
    noResult: [{ type: Output, args: ['no-result',] }],
    group: [{ type: Input }]
};
if (false) {
    /** @type {?} */
    CompleterComponent.prototype.dropdown;
    /** @type {?} */
    CompleterComponent.prototype.cleared;
    /** @type {?} */
    CompleterComponent.prototype.selected;
    /** @type {?} */
    CompleterComponent.prototype.noResult;
    /** @type {?} */
    CompleterComponent.prototype.group;
    /** @type {?} */
    CompleterComponent.prototype._change;
    /** @type {?} */
    CompleterComponent.prototype._items;
    /** @type {?} */
    CompleterComponent.prototype._completer;
    /** @type {?} */
    CompleterComponent.prototype._highlight;
    /** @type {?} */
    CompleterComponent.prototype._disabled;
    /** @type {?} */
    CompleterComponent.prototype._DOM;
    /**
     * @type {?}
     * @private
     */
    CompleterComponent.prototype._zone;
    /** @type {?} */
    CompleterComponent.prototype.cd;
}
//# sourceMappingURL=data:application/json;base64,eyJ2ZXJzaW9uIjozLCJmaWxlIjoiY29tcGxldGVyLmNvbXBvbmVudC5qcyIsInNvdXJjZVJvb3QiOiJuZzovL25nLWF1dG8tY29tcGxldGUvIiwic291cmNlcyI6WyJsaWIvY29tcGxldGVyL2NvbXBsZXRlci5jb21wb25lbnQudHMiXSwibmFtZXMiOltdLCJtYXBwaW5ncyI6Ijs7Ozs7QUFBQSxPQUFPLEVBQUUsWUFBWSxFQUFFLE1BQU0sZ0JBQWdCLENBQUM7QUFDOUMsT0FBTyxFQUFFLFNBQVMsRUFBRSxZQUFZLEVBQUUsS0FBSyxFQUFFLE1BQU0sRUFBVSxNQUFNLEVBQUUsU0FBUyxFQUFFLHVCQUF1QixFQUFFLGlCQUFpQixFQUFFLE1BQU0sZUFBZSxDQUFDO0FBQzlJLE9BQU8sRUFBRSxpQkFBaUIsRUFBRSxNQUFNLDhCQUE4QixDQUFDO0FBQ2pFLE9BQU8sRUFFSCw0QkFBNEIsRUFDNUIsNEJBQTRCLEVBRS9CLE1BQU0sNkJBQTZCLENBQUM7QUFDckMsT0FBTyxFQUFFLG1CQUFtQixFQUFFLE1BQU0sbUNBQW1DLENBQUM7QUFFeEUsT0FBTyxFQUFFLE9BQU8sRUFBRSxNQUFNLE1BQU0sQ0FBQztBQW9HL0IsTUFBTSxPQUFPLGtCQUFrQjs7Ozs7SUF3QjNCLFlBQW9CLEtBQWEsRUFBUyxFQUFxQjtRQUEzQyxVQUFLLEdBQUwsS0FBSyxDQUFRO1FBQVMsT0FBRSxHQUFGLEVBQUUsQ0FBbUI7UUFyQjlDLFlBQU8sR0FBeUIsSUFBSSxZQUFZLEVBQVUsQ0FBQztRQUMzRCxhQUFRLEdBQTRDLElBQUksWUFBWSxFQUE2QixDQUFDO1FBQ3ZGLGFBQVEsR0FBZ0MsSUFBSSxZQUFZLEVBQWlCLENBQUM7UUFFdEYsVUFBSyxHQUFzQixtQkFBbUIsRUFBRSxFQUFBLENBQUM7UUFFakUsWUFBTyxHQUFvQixJQUFJLE9BQU8sRUFBVSxDQUFDO1FBQ2pELFdBQU0sR0FBMEMsRUFBRSxDQUFDO1FBQ25ELGVBQVUsR0FBVyxFQUFFLENBQUM7UUFDeEIsZUFBVSxHQUFXLEVBQUUsQ0FBQztRQUN4QixjQUFTLEdB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UUFBUSxFQUFFLGNBQWM7Z0JBQ3hCLFFBQVEsRUFBRTs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7ZUFxREM7Z0JBeUNYLGVBQWUsRUFBRSx1QkFBdUIsQ0FBQyxNQUFNO3lCQXhDdEM7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7OztLQXVDUjthQUVKOzs7O1lBN0d3QyxNQUFNO1lBQXNELGlCQUFpQjs7O3VCQStHakgsU0FBUyxTQUFDLG1CQUFtQjtzQkFFN0IsTUFBTTt1QkFDTixNQUFNO3VCQUNOLE1BQU0sU0FBQyxXQUFXO29CQUVsQixLQUFLOzs7O0lBTk4sc0NBQXFFOztJQUVyRSxxQ0FBNEU7O0lBQzVFLHNDQUFtSDs7SUFDbkgsc0NBQXNHOztJQUV0RyxtQ0FBaUU7O0lBRWpFLHFDQUFpRDs7SUFDakQsb0NBQW1EOztJQUNuRCx3Q0FBd0I7O0lBQ3hCLHdDQUF3Qjs7SUFDeEIsdUNBQTJCOztJQUUzQixrQ0FPRTs7Ozs7SUFFVSxtQ0FBcUI7O0lBQUUsZ0NBQTRCIiwic291cmNlc0NvbnRlbnQiOlsiaW1wb3J0IHsgZGVib3VuY2VUaW1lIH0gZnJvbSAncnhqcy9vcGVyYXRvcnMnO1xuaW1wb3J0IHsgQ29tcG9uZW50LCBFdmVudEVtaXR0ZXIsIElucHV0LCBOZ1pvbmUsIE9uSW5pdCwgT3V0cHV0LCBWaWV3Q2hpbGQsIENoYW5nZURldGVjdGlvblN0cmF0ZWd5LCBDaGFuZ2VEZXRlY3RvclJlZiB9IGZyb20gJ0Bhbmd1bGFyL2NvcmUnO1xuaW1wb3J0IHsgQXV0b2NvbXBsZXRlR3JvdXAgfSBmcm9tICcuLi9jbGFzc2VzL0F1dG9jb21wbGV0ZUdyb3VwJztcbmltcG9ydCB7XG4gICAgQXV0b2NvbXBsZXRlSXRlbSxcbiAgICBDb21wYXJhYmxlQXV0b0NvbXBsZXRlU3RyaW5nLFxuICAgIFNlYXJjaGFibGVBdXRvQ29tcGxldGVTdHJpbmcsXG4gICAgU3RyaXBwZWRBdXRvY29tcGxldGVHcm91cFxufSBmcm9tICcuLi9jbGFzc2VzL0F1dG9jb21wbGV0ZUl0ZW0nO1xuaW1wb3J0IHsgTmdEcm9wZG93bkRpcmVjdGl2ZSB9IGZyb20gJy4uL2Ryb3Bkb3duL25nLWRyb3Bkb3duLmRpcmVjdGl2ZSc7XG5pbXBvcnQgeyBHcm91cE5vUmVzdWx0IH0gZnJvbSAnLi4vdXRpbHMvdXRpbHMnO1xuaW1wb3J0IHsgU3ViamVjdCB9IGZyb20gJ3J4anMnO1xuXG5AQ29tcG9uZW50KHtcbiAgICBzZWxlY3RvcjogJ25nLWNvbXBsZXRlcicsXG4gICAgdGVtcGxhdGU6IGBcbiAgICAgICAgPGRpdiAjZWxlbWVudCBjbGFzcz1cIm5nLWF1dG9jb21wbGV0ZS1kcm9wZG93blwiXG4gICAgICAgICAgICAgW25nQ2xhc3NdPVwieydvcGVuJzogZHJvcGRvd24uX29wZW4sICdpcy1sb2FkaW5nJzogX0RPTS5pc0xvYWRpbmcsICdpcy1hc3luYyc6IGdyb3VwLmFzeW5jICE9PSBudWxsfVwiPlxuXG4gICAgICAgICAgICA8IS0tR1JPVVA6IHt7Z3JvdXAua2V5fX0tLT5cblxuICAgICAgICAgICAgPGRpdiBjbGFzcz1cIm5nLWF1dG9jb21wbGV0ZS1pbnB1dHNcIiAoY2xpY2spPVwiUmVnaXN0ZXJDbGljaygpXCJcbiAgICAgICAgICAgICAgICAgW25nQ2xhc3NdPVwieydjb21wbGV0aW9uLW9mZic6ICFncm91cC5jb21wbGV0aW9ufVwiPlxuICAgICAgICAgICAgICAgIDxzcGFuIGNsYXNzPVwibmctYXV0b2NvbXBsZXRlLXBsYWNlaG9sZGVyXCJcbiAgICAgICAgICAgICAgICAgICAgICAqbmdJZj1cIl9ET00ucGxhY2Vob2xkZXJcIj5cbiAgICAgICAgICAgICAgICAgIDxuZy1jb250YWluZXIgKm5nSWY9XCJncm91cC5wbGFjZWhvbGRlclZhbHVlXCI+XG4gICAgICAgICAgICAgICAgICAgICAgPG5nLXRlbXBsYXRlICpuZ1RlbXBsYXRlT3V0bGV0PVwiZ3JvdXAucGxhY2Vob2xkZXJWYWx1ZTsgY29udGV4dDogeyRpbXBsaWNpdDogX0RPTS5wbGFjZWhvbGRlcn1cIj48L25nLXRlbXBsYXRlPlxuICAgICAgICAgICAgICAgICAgPC9uZy1jb250YWluZXI+XG4gICAgICAgICAgICAgICAgICA8bmctdGVtcGxhdGUgW25nSWZdPVwiIWdyb3VwLnBsYWNlaG9sZGVyVmFsdWVcIj5cbiAgICAgICAgICAgICAgICAgICAgICB7e19ET00ucGxhY2Vob2xkZXIudGl0bGV9fVxuICAgICAgICAgICAgICAgICAgPC9uZy10ZW1wbGF0ZT5cbiAgICAgICAgICAgICAgICA8L3NwYW4+XG4gICAgICAgICAgICAgICAgPGlucHV0ICNpbnB1dCB0eXBlPVwidGV4dFwiIFtwbGFjZWhvbGRlcl09XCJncm91cC5wbGFjZWhvbGRlclwiIG5hbWU9XCJjb21wbGV0ZXJcIiBbbmdNb2RlbF09XCJfY29tcGxldGVyXCJcbiAgICAgICAgICAgICAgICAgICAgICAgKG5nTW9kZWxDaGFuZ2UpPVwiX2NoYW5nZS5uZXh0KCRldmVudCk7XCJcbiAgICAgICAgICAgICAgICAgICAgICAgW3ZhbHVlXT1cIl9jb21wbGV0ZXJcIlxuICAgICAgICAgICAgICAgICAgICAgICBbdGFiSW5kZXhdPVwiX2Rpc2FibGVkID8gLTEgOiAwXCJcbiAgICAgICAgICAgICAgICAgICAgICAgYXV0b2NvbXBsZXRlPVwibmV3LXBhc3N3b3JkXCJcbiAgICAgICAgICAgICAgICAgICAgICAgKGZvY3VzKT1cIk9wZW5Ecm9wZG93bigpXCIgY2xhc3M9XCJuZy1hdXRvY29tcGxldGUtaW5wdXRcIj5cblxuICAgICAgICAgICAgICAgIDxzcGFuIFtuZ0NsYXNzXT1cInsnb3Blbic6IGRyb3Bkb3duLl9vcGVufVwiIGNsYXNzPVwibmctYXV0b2NvbXBsZXRlLWRyb3Bkb3duLWljb25cIlxuICAgICAgICAgICAgICAgICAgICAgIChjbGljayk9XCJEcm9wZG93bkFycmF5KClcIj48L3NwYW4+XG4gICAgICAgICAgICA8L2Rpdj5cblxuICAgICAgICAgICAgPGRpdiBjbGFzcz1cIm5nLWRyb3Bkb3duXCIgbmdEcm9wZG93biBbbGlzdF09XCJfaXRlbXNcIiBbZWxlbWVudF09XCJlbGVtZW50XCIgW2lucHV0XT1cImlucHV0XCJcbiAgICAgICAgICAgICAgICAgW25nQ2xhc3NdPVwieydpcy1pbml0aWFsLWVtcHR5JzogX0RPTS5lbXB0eX1cIlxuICAgICAgICAgICAgICAgICBbYWN0aXZlXT1cIl9ET00uc2VsZWN0ZWRcIiBba2V5XT1cImdyb3VwLmtleVwiXG4gICAgICAgICAgICAgICAgIFtjb21wbGV0aW9uXT1cImdyb3VwLmNvbXBsZXRpb25cIlxuICAgICAgICAgICAgICAgICBbcGFyZW50RGV0ZWN0b3JdPVwiY2RcIlxuICAgICAgICAgICAgICAgICAoaG92ZXIpPVwiT25Ib3ZlckRyb3Bkb3duSXRlbSgkZXZlbnQpXCJcbiAgICAgICAgICAgICAgICAgKHNlbGVjdGVkKT1cIlNlbGVjdEl0ZW0oJGV2ZW50KVwiXG4gICAgICAgICAgICAgICAgIChjbG9zZWQpPVwiT25JbnB1dEJsdXJyZWQoKVwiXG4gICAgICAgICAgICA+XG4gICAgICAgICAgICAgICAgPGRpdiAqbmdJZj1cIl9ET00ubm90Rm91bmQgJiYgZ3JvdXAubm9SZXN1bHRzXCIgY2xhc3M9XCJkcm9wZG93bi1pdGVtIG5vLXJlc3VsdHNcIj5cbiAgICAgICAgICAgICAgICAgICAgPG5nLWNvbnRhaW5lciAqbmdJZj1cImdyb3VwLm5vUmVzdWx0c1wiPlxuICAgICAgICAgICAgICAgICAgICAgICAgPG5nLXRlbXBsYXRlICpuZ1RlbXBsYXRlT3V0bGV0PVwiZ3JvdXAubm9SZXN1bHRzOyBjb250ZXh0OiB7JGltcGxpY2l0OiBfY29tcGxldGVyfVwiPjwvbmctdGVtcGxhdGU+XG4gICAgICAgICAgICAgICAgICAgIDwvbmctY29udGFpbmVyPlxuICAgICAgICAgICAgICAgIDwvZGl2PlxuXG4gICAgICAgICAgICAgICAgPGRpdiBjbGFzcz1cImRyb3Bkb3duLWl0ZW1cIiAqbmdGb3I9XCJsZXQgaXRlbSBvZiBfaXRlbXMgfCBrZXlzOyBsZXQgaSA9IGluZGV4XCJcbiAgICAgICAgICAgICAgICAgICAgIChjbGljayk9XCJTZWxlY3RJdGVtKF9pdGVtc1tpdGVtXSlcIiBbbmdDbGFzc109XCJfaXRlbXNbaXRlbV0uY2xhc3NOYW1lXCI+XG4gICAgICAgICAgICAgICAgICAgIDxuZy1jb250YWluZXIgKm5nSWY9XCJncm91cC5kcm9wZG93blZhbHVlXCI+XG4gICAgICAgICAgICAgICAgICAgICAgICA8bmctdGVtcGxhdGVcbiAgICAgICAgICAgICAgICAgICAgICAgICAgICAqbmdUZW1wbGF0ZU91dGxldD1cImdyb3VwLmRyb3Bkb3duVmFsdWU7IGNvbnRleHQ6IHskaW1wbGljaXQ6IF9pdGVtc1tpdGVtXSwgaGlnaGxpZ2h0OiBfaXRlbXNbaXRlbV0udGl0bGUgfCBoaWdobGlnaHQ6X2hpZ2hsaWdodH1cIj48L25nLXRlbXBsYXRlPlxuICAgICAgICAgICAgICAgICAgICA8L25nLWNvbnRhaW5lcj5cblxuICAgICAgICAgICAgICAgICAgICA8ZGl2ICpuZ0lmPVwiIWdyb3VwLmRyb3Bkb3duVmFsdWVcIiBbaW5uZXJIVE1MXT1cIl9pdGVtc1tpdGVtXS50aXRsZSB8IGhpZ2hsaWdodDpfaGlnaGxpZ2h0XCI+PC9kaXY+XG4gICAgICAgICAgICAgICAgPC9kaXY+XG4gICAgICAgICAgICA8L2Rpdj5cbiAgICAgICAgPC9kaXY+YCxcbiAgICBzdHlsZXM6IFtgXG4gICAgICAgIC5uZy1hdXRvY29tcGxldGUtaW5wdXRzIHtcbiAgICAgICAgICAgIHBvc2l0aW9uOiByZWxhdGl2ZTtcbiAgICAgICAgfVxuXG4gICAgICAgIC5uZy1hdXRvY29tcGxldGUtaW5wdXRzIGlucHV0W3R5cGU9dGV4dF06Oi1tcy1jbGVhcixcbiAgICAgICAgLm5nLWF1dG9jb21wbGV0ZS1pbnB1dHMgaW5wdXRbdHlwZT10ZXh0XTo6LW1zLXJldmVhbCB7XG4gICAgICAgICAgICBkaXNwbGF5OiBub25lO1xuICAgICAgICAgICAgd2lkdGg6IDA7XG4gICAgICAgICAgICBoZWlnaHQ6IDA7XG4gICAgICAgIH1cblxuICAgICAgICAubmctYXV0b2NvbXBsZXRlLWlucHV0cy5jb21wbGV0aW9uLW9mZiB7XG4gICAgICAgICAgICBjdXJzb3I6IHBvaW50ZXI7XG4gICAgICAgIH1cblxuICAgICAgICAubmctYXV0b2NvbXBsZXRlLWlucHV0cy5jb21wbGV0aW9uLW9mZiBpbnB1dCB7XG4gICAgICAgICAgICBwb2ludGVyLWV2ZW50czogbm9uZTtcbiAgICAgICAgfVxuXG4gICAgICAgIC5uZy1hdXRvY29tcGxldGUtcGxhY2Vob2xkZXIge1xuICAgICAgICAgICAgcG9pbnRlci1ldmVudHM6IG5vbmU7XG4gICAgICAgIH1cblxuICAgICAgICAubmctYXV0b2NvbXBsZXRlLWRyb3Bkb3duLWljb24ge1xuXG4gICAgICAgIH1cblxuICAgICAgICAubmctYXV0b2NvbXBsZXRlLWRyb3Bkb3duIC5uZy1kcm9wZG93biB7XG4gICAgICAgICAgICBkaXNwbGF5OiBub25lO1xuICAgICAgICB9XG5cbiAgICAgICAgLm5nLWF1dG9jb21wbGV0ZS1kcm9wZG93biAubmctZHJvcGRvd24uaXMtZW1wdHkge1xuICAgICAgICAgICAgZGlzcGxheTogbm9uZTtcbiAgICAgICAgfVxuXG4gICAgICAgIC5uZy1hdXRvY29tcGxldGUtZHJvcGRvd24gLm5nLWRyb3Bkb3duLm9wZW4ge1xuICAgICAgICAgICAgZGlzcGxheTogYmxvY2s7XG4gICAgICAgIH1cbiAgICBgXSxcbiAgICBjaGFuZ2VEZXRlY3Rpb246IENoYW5nZURldGVjdGlvblN0cmF0ZWd5Lk9uUHVzaFxufSlcbmV4cG9ydCBjbGFzcyBDb21wbGV0ZXJDb21wb25lbnQgaW1wbGVtZW50cyBPbkluaXQge1xuICAgIEBWaWV3Q2hpbGQoTmdEcm9wZG93bkRpcmVjdGl2ZSkgcHVibGljIGRyb3Bkb3duOiBOZ0Ryb3Bkb3duRGlyZWN0aXZlO1xuXG4gICAgQE91dHB1dCgpIHB1YmxpYyBjbGVhcmVkOiBFdmVudEVtaXR0ZXI8c3RyaW5nPiA9IG5ldyBFdmVudEVtaXR0ZXI8c3RyaW5nPigpO1xuICAgIEBPdXRwdXQoKSBwdWJsaWMgc2VsZWN0ZWQ6IEV2ZW50RW1pdHRlcjxTdHJpcHBlZEF1dG9jb21wbGV0ZUdyb3VwPiA9IG5ldyBFdmVudEVtaXR0ZXI8U3RyaXBwZWRBdXRvY29tcGxldGVHcm91cD4oKTtcbiAgICBAT3V0cHV0KCduby1yZXN1bHQnKSBwdWJsaWMgbm9SZXN1bHQ6IEV2ZW50RW1pdHRlcjxHcm91cE5vUmVzdWx0PiA9IG5ldyBFdmVudEVtaXR0ZXI8R3JvdXBOb1Jlc3VsdD4oKTtcblxuICAgIEBJbnB1dCgpIHB1YmxpYyBncm91cDogQXV0b2NvbXBsZXRlR3JvdXAgPSA8QXV0b2NvbXBsZXRlR3JvdXA+e307XG5cbiAgICBfY2hhbmdlOiBTdWJqZWN0PHN0cmluZz4gPSBuZXcgU3ViamVjdDxzdHJpbmc+KCk7XG4gICAgX2l0ZW1zOiB7IFt2YWx1ZTogc3RyaW5nXTogQXV0b2NvbXBsZXRlSXRlbSB9ID0ge307XG4gICAgX2NvbXBsZXRlcjogc3RyaW5nID0gJyc7XG4gICAgX2hpZ2hsaWdodDogc3RyaW5nID0gJyc7XG4gICAgX2Rpc2FibGVkOiBib29sZWFuID0gZmFsc2U7XG5cbiAgICBfRE9NID0ge1xuICAgICAgICBub3RGb3VuZDogPGJvb2xlYW4+ZmFsc2UsXG4gICAgICAgIGVtcHR5OiA8Ym9vbGVhbj5mYWxzZSxcbiAgICAgICAgcGxhY2Vob2xkZXI6IDxBdXRvY29tcGxldGVJdGVtPm51bGwsXG4gICAgICAgIHNlbGVjdGVkOiA8c3RyaW5nPicnLFxuICAgICAgICBpc0xvYWRpbmc6IDxib29sZWFuPmZhbHNlXG5cbiAgICB9O1xuXG4gICAgY29uc3RydWN0b3IocHJpdmF0ZSBfem9uZTogTmdab25lLCBwdWJsaWMgY2Q6IENoYW5nZURldGVjdG9yUmVmKSB7XG4gICAgfVxuXG4gICAgLyoqXG4gICAgICpcbiAgICAgKi9cbiAgICBuZ09uSW5pdCgpIHtcbiAgICAgICAgdGhpcy5fem9uZS5ydW5PdXRzaWRlQW5ndWxhcigoKSA9PiB7XG5cbiAgICAgICAgICAgIHRoaXMuX2NoYW5nZS5waXBlKFxuICAgICAgICAgICAgICAgIGRlYm91bmNlVGltZSgzMDApKVxuICAgICAgICAgICAgICAgIC5zdWJzY3JpYmUoKHZhbHVlOiBzdHJpbmcpID0+IHtcbiAgICAgICAgICAgICAgICAgICAgdGhpcy5fem9uZS5ydW4oKCkgPT4ge1xuICAgICAgICAgICAgICAgICAgICAgICAgaWYgKHRoaXMuZ3JvdXAuYXN5bmMgIT09IG51bGwpIHtcbiAgICAgICAgICAgICAgICAgICAgICAgICAgICB0aGlzLlJ1bkFzeW5jRnVuY3Rpb24odmFsdWUpO1xuICAgICAgICAgICAgICAgICAgICAgICAgfSBlbHNlIHtcbiAgICAgICAgICAgICAgICAgICAgICAgICAgICB0aGlzLk9uTW9kZWxDaGFuZ2UodmFsdWUpO1xuICAgICAgICAgICAgICAgICAgICAgICAgfVxuXG4gICAgICAgICAgICAgICAgICAgICAgICB0aGlzLmNkLmRldGVjdENoYW5nZXMoKTtcbiAgICAgICAgICAgICAgICAgICAgfSk7XG4gICAgICAgICAgICAgICAgfSk7XG4gICAgICAgIH0pO1xuXG4gICAgICAgIHRoaXMuU2V0SXRlbXMoKTtcbiAgICB9XG5cbiAgICAvKipcbiAgICAgKiBPbmx5IHVzZWQgd2hlbiBjb21wbGV0aW9uIGlzIG9mZi5cbiAgICAgKi9cbiAgICBSZWdpc3RlckNsaWNrKCkge1xuICAgICAgICBpZiAoIXRoaXMuZ3JvdXAuY29tcGxldGlvbikge1xuICAgICAgICAgICAgdGhpcy5Td2l0Y2hEcm9wZG93blN0YXRlKCk7XG4gICAgICAgIH1cbiAgICB9XG5cbiAgICAvKipcbiAgICAgKlxuICAgICAqL1xuICAgIERyb3Bkb3duQXJyYXkoKSB7XG4gICAgICAgIGlmICh0aGlzLmdyb3VwLmNvbXBsZXRpb24pIHtcbiAgICAgICAgICAgIHRoaXMuU3dpdGNoRHJvcGRvd25TdGF0ZSgpO1xuICAgICAgICB9XG4gICAgfVxuXG4gICAgLyoqXG4gICAgICpcbiAgICAgKi9cbiAgICBTd2l0Y2hEcm9wZG93blN0YXRlKCkge1xuICAgICAgICBpZiAodGhpcy5kcm9wZG93bi5fb3Blbikge1xuICAgICAgICAgICAgdGhpcy5DbG9zZURyb3Bkb3duKCk7XG4gICAgICAgICAgICByZXR1cm47XG4gICAgICAgIH1cblxuICAgICAgICAvKipcbiAgICAgICAgICpcbiAgICAgICAgICovXG4gICAgICAgIHRoaXMuT3BlbkRyb3Bkb3duKCk7XG4gICAgfVxuXG4gICAgLyoqXG4gICAgICpcbiAgICAgKi9cbiAgICBDbG9zZURyb3Bkb3duKCkge1xuICAgICAgICB0aGlzLmRyb3Bkb3duLl9vcGVuID0gZmFsc2U7XG5cbiAgICAgICAgLyoqXG4gICAgICAgICAqXG4gICAgICAgICAqL1xuICAgICAgICB0aGlzLl9ET00ucGxhY2Vob2xkZXIgPSBudWxsO1xuICAgIH1cblxuICAgIC8qKlxuICAgICAqXG4gICAgICovXG4gICAgT3BlbkRyb3Bkb3duKCkge1xuICAgICAgICB0aGlzLmRyb3Bkb3duLk9wZW4oKTtcblxuICAgICAgICAvKipcbiAgICAgICAgICpcbiAgICAgICAgICovXG4gICAgICAgIHRoaXMuX0RPTS5wbGFjZWhvbGRlciA9IG51bGw7XG4gICAgfVxuXG4gICAgLyoqXG4gICAgICpcbiAgICAgKi9cbiAgICBTZXRJdGVtcygpIHtcbiAgICAgICAgdGhpcy5faXRlbXMgPSB0aGlzLmdyb3VwLnZhbHVlO1xuICAgICAgICB0aGlzLklzSW5pdGlhbEVtcHR5KCk7XG4gICAgfVxuXG4gICAgLyoqXG4gICAgICpcbiAgICAgKi9cbiAgICBTZWxlY3RJdGVtKGl0ZW06IEF1dG9jb21wbGV0ZUl0ZW0gfCBzdHJpbmcpIHtcbiAgICAgICAgbGV0IGk6IEF1dG9jb21wbGV0ZUl0ZW07XG4gICAgICAgIGlmICh0eXBlb2YgaXRlbSA9PT0gJ3N0cmluZycpIHtcbiAgICAgICAgICAgIGkgPSB0aGlzLl9pdGVtc1tpdGVtXTtcbiAgICAgICAgICAgIHRoaXMuX0RPTS5zZWxlY3RlZCA9IGl0ZW07XG4gICAgICAgIH0gZWxzZSB7XG4gICAgICAgICAgICBpID0gaXRlbTtcbiAgICAgICAgICAgIHRoaXMuX0RPTS5zZWxlY3RlZCA9IFNlYXJjaGFibGVBdXRvQ29tcGxldGVTdHJpbmcoaXRlbS50aXRsZSwgaXRlbS5pZCk7XG4gICAgICAgIH1cblxuICAgICAgICB0aGlzLl9jb21wbGV0ZXIgPSBpLnRpdGxlO1xuICAgICAgICB0aGlzLl9oaWdobGlnaHQgPSAnJztcblxuICAgICAgICB0aGlzLmRyb3Bkb3duLkNsb3NlKG51bGwsIHRydWUpO1xuICAgICAgICB0aGlzLnNlbGVjdGVkLmVtaXQoe2dyb3VwOiB7a2V5OiB0aGlzLmdyb3VwLmtleX0sIGl0ZW06IGl9KTtcbiAgICB9XG5cbiAgICAvKipcbiAgICAgKlxuICAgICAqL1xuICAgIGFzeW5jIFJ1bkFzeW5jRnVuY3Rpb24odmFsdWU6IHN0cmluZykge1xuICAgICAgICB0aGlzLl9jb21wbGV0ZXIgPSB2YWx1ZTtcbiAgICAgICAgdGhpcy5faGlnaGxpZ2h0ID0gdmFsdWU7XG5cbiAgICAgICAgdGhpcy5fRE9NLnNlbGVjdGVkID0gbnVsbDtcblxuICAgICAgICBpZiAodmFsdWUubGVuZ3RoID09PSAwKSB7XG4gICAgICAgICAgICB0aGlzLmdyb3VwLkluaXRpYWxWYWx1ZSgpO1xuICAgICAgICAgICAgdGhpcy5DbGVhck1vZGVsKCk7XG5cbiAgICAgICAgICAgIHRoaXMuZHJvcGRvd24uQ2xvc2UoJycsIHRydWUpO1xuICAgICAgICB9IGVsc2UgaWYgKHZhbHVlLmxlbmd0aCA+IHRoaXMuZ3JvdXAuc2VhcmNoTGVuZ3RoKSB7XG4gICAgICAgICAgICB0aGlzLl9ET00uaXNMb2FkaW5nID0gdHJ1ZTtcblxuICAgICAgICAgICAgY29uc3QgdmFsdWVzID0gYXdhaXQgdGhpcy5ncm91cC5hc3luYyh2YWx1ZSk7XG4gICAgICAgICAgICB0aGlzLmdyb3VwLlNldE5ld1ZhbHVlKHZhbHVlcywgdGhpcy5ncm91cC5rZXlzLnRpdGxlS2V5KTtcblxuICAgICAgICAgICAgdGhpcy5fRE9NLmlzTG9hZGluZyA9IGZhbHNlO1xuXG4gICAgICAgICAgICB0aGlzLl9pdGVtcyA9IHRoaXMuZ3JvdXAudmFsdWU7XG4gICAgICAgICAgICB0aGlzLkVtcHR5U2VhcmNoKHRoaXMuX2l0ZW1zLCB2YWx1ZSk7XG5cbiAgICAgICAgICAgIC8vIFVzZXIgaGFzIHR5cGVkIHNvbWV0aGluZyBub3csIHJlc3VsdHMgY291bGQgYmUgc2hvd24uIFdlIG5lZWQgdG8gcmVtb3ZlIHRoZSBcImlzLWluaXRpYWwtZW1wdHlcIiBjbGFzcy5cbiAgICAgICAgICAgIHRoaXMuSXNJbml0aWFsRW1wdHkoKTtcbiAgICAgICAgICAgIHRoaXMuZHJvcGRvd24uT3BlbigpO1xuICAgICAgICB9XG5cbiAgICAgICAgdGhpcy5jZC5kZXRlY3RDaGFuZ2VzKCk7XG4gICAgfVxuXG4gICAgLyoqXG4gICAgICpcbiAgICAgKi9cbiAgICBPbk1vZGVsQ2hhbmdlKHZhbHVlOiBzdHJpbmcpIHtcbiAgICAgICAgdGhpcy5fY29tcGxldGVyID0gdmFsdWU7XG4gICAgICAgIHRoaXMuX2hpZ2hsaWdodCA9IHZhbHVlO1xuXG4gICAgICAgIHRoaXMuX0RPTS5zZWxlY3RlZCA9IG51bGw7XG5cbiAgICAgICAgaWYgKHZhbHVlLmxlbmd0aCA9PT0gMCkge1xuICAgICAgICAgICAgdGhpcy5DbGVhck1vZGVsKCk7XG4gICAgICAgIH0gZWxzZSBpZiAodmFsdWUubGVuZ3RoID4gdGhpcy5ncm91cC5zZWFyY2hMZW5ndGgpIHtcbiAgICAgICAgICAgIHRoaXMuQ29tcGFyZUl0ZW1zQW5kU2V0KHZhbHVlKTtcbiAgICAgICAgfVxuICAgIH1cblxuICAgIC8qKlxuICAgICAqXG4gICAgICovXG4gICAgQ2xlYXJNb2RlbCgpIHtcbiAgICAgICAgdGhpcy5fRE9NLnNlbGVjdGVkID0gbnVsbDtcbiAgICAgICAgdGhpcy5fRE9NLm5vdEZvdW5kID0gZmFsc2U7XG5cbiAgICAgICAgdGhpcy5jbGVhcmVkLmVtaXQodGhpcy5ncm91cC5rZXkpO1xuICAgIH1cblxuICAgIC8qKlxuICAgICAqXG4gICAgICovXG4gICAgQ29tcGFyZUl0ZW1zQW5kU2V0KHZhbHVlOiBzdHJpbmcpIHtcbiAgICAgICAgY29uc3Qgb2JqID0ge307XG4gICAgICAgIGZvciAoY29uc3Qga2V5IGluIHRoaXMuZ3JvdXAudmFsdWUpIHtcbiAgICAgICAgICAgIGlmIChDb21wYXJhYmxlQXV0b0NvbXBsZXRlU3RyaW5nKGtleSkudG9Mb3dlckNhc2UoKS5pbmRleE9mKHZhbHVlLnRvTG93ZXJDYXNlKCkpID4gLTEpIHtcbiAgICAgICAgICAgICAgICBvYmpba2V5XSA9IHRoaXMuZ3JvdXAudmFsdWVba2V5XTtcbiAgICAgICAgICAgIH1cbiAgICAgICAgfVxuXG4gICAgICAgIHRoaXMuX2l0ZW1zID0gb2JqO1xuICAgICAgICB0aGlzLkVtcHR5U2VhcmNoKHRoaXMuX2l0ZW1zLCB2YWx1ZSk7XG5cbiAgICAgICAgLy8gVXNlciBoYXMgdHlwZWQgc29tZXRoaW5nIG5vdywgcmVzdWx0cyBjb3VsZCBiZSBzaG93bi4gV2UgbmVlZCB0byByZW1vdmUgdGhlIFwiaXMtaW5pdGlhbC1lbXB0eVwiIGNsYXNzLlxuICAgICAgICB0aGlzLklzSW5pdGlhbEVtcHR5KCk7XG4gICAgICAgIHRoaXMuZHJvcGRvd24uT3BlbigpO1xuICAgIH1cblxuICAgIC8qKlxuICAgICAqXG4gICAgICovXG4gICAgT25JbnB1dEJsdXJyZWQoKSB7XG4gICAgICAgIGlmICghdGhpcy5IYXNDaG9zZW5WYWx1ZSgpKSB7XG4gICAgICAgICAgICAvKipcbiAgICAgICAgICAgICAqIExldCBjb21wb25lbnQga25vdyBjb21wbGV0ZXIgaW5wdXQgaGFzIGJlZW4gY2xlYXJlZCAtXG4gICAgICAgICAgICAgKiB0aGlzIGZ1bmN0aW9uIHNob3dzIHRoZSBsaXN0IGFnYWluLCBhbHNvIHJlc2V0cyBjaGlsZHJlbiwgaWYgY2hvc2VuLlxuICAgICAgICAgICAgICovXG4gICAgICAgICAgICB0aGlzLk9uTW9kZWxDaGFuZ2UoJycpO1xuICAgICAgICB9XG4gICAgfVxuXG4gICAgLyoqXG4gICAgICpcbiAgICAgKi9cbiAgICBPbkhvdmVyRHJvcGRvd25JdGVtKGl0ZW06IEF1dG9jb21wbGV0ZUl0ZW0gfCBzdHJpbmcpIHtcbiAgICAgICAgaWYgKHR5cGVvZiBpdGVtID09PSAnc3RyaW5nJykge1xuICAgICAgICAgICAgdGhpcy5fRE9NLnBsYWNlaG9sZGVyID0gdGhpcy5faXRlbXNbaXRlbV07XG4gICAgICAgICAgICByZXR1cm47XG4gICAgICAgIH1cbiAgICAgICAgaWYgKGl0ZW0gPT0gbnVsbCkge1xuICAgICAgICAgICAgdGhpcy5fRE9NLnBsYWNlaG9sZGVyID0gbnVsbDtcbiAgICAgICAgICAgIHJldHVybjtcbiAgICAgICAgfVxuXG4gICAgICAgIHRoaXMuX0RPTS5wbGFjZWhvbGRlciA9IGl0ZW07XG4gICAgfVxuXG4gICAgLy8gPT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT0vL1xuICAgIC8vICEgVXRpbHMgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgLy9cbiAgICAvLyA9PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PS8vXG5cbiAgICBJc0luaXRpYWxFbXB0eSgpIHtcbiAgICAgICAgaWYgKE9iamVjdC5rZXlzKHRoaXMuX2l0ZW1zKS5sZW5ndGggPT09IDAgJiYgdGhpcy5fY29tcGxldGVyLmxlbmd0aCA9PT0gMCkge1xuICAgICAgICAgICAgdGhpcy5fRE9NLmVtcHR5ID0gdHJ1ZTtcbiAgICAgICAgICAgIHJldHVybjtcbiAgICAgICAgfVxuXG4gICAgICAgIHRoaXMuX0RPTS5lbXB0eSA9IGZhbHNlO1xuICAgIH1cblxuICAgIC8qKlxuICAgICAqXG4gICAgICovXG4gICAgSGFzQ2hvc2VuVmFsdWUoKTogYm9vbGVhbiB7XG4gICAgICAgIHJldHVybiB0aGlzLl9ET00uc2VsZWN0ZWQgIT09IG51bGw7XG4gICAgfVxuXG4gICAgLyoqXG4gICAgICpcbiAgICAgKi9cbiAgICBFbXB0eVNlYXJjaChvYmo6IE9iamVjdCwgcXVlcnk6IHN0cmluZykge1xuICAgICAgICBpZiAoT2JqZWN0LmtleXMob2JqKS5sZW5ndGggPiAwKSB7XG4gICAgICAgICAgICB0aGlzLl9ET00ubm90Rm91bmQgPSBmYWxzZTtcbiAgICAgICAgICAgIHJldHVybjtcbiAgICAgICAgfVxuXG4gICAgICAgIHRoaXMuX0RPTS5ub3RGb3VuZCA9IHRydWU7XG4gICAgICAgIHRoaXMubm9SZXN1bHQuZW1pdCh7Z3JvdXA6IHtrZXk6IHRoaXMuZ3JvdXAua2V5fSwgcXVlcnk6IHF1ZXJ5fSk7XG4gICAgfVxuXG4gICAgLyoqXG4gICAgICpcbiAgICAgKi9cbiAgICBDbGVhclZhbHVlKCkge1xuICAgICAgICB0aGlzLl9jb21wbGV0ZXIgPSAnJztcbiAgICAgICAgdGhpcy5fRE9NLnNlbGVjdGVkID0gbnVsbDtcblxuICAgICAgICB0aGlzLmdyb3VwLkluaXRpYWxWYWx1ZSgpO1xuICAgICAgICB0aGlzLklzSW5pdGlhbEVtcHR5KCk7XG4gICAgICAgIC8qKlxuICAgICAgICAgKlxuICAgICAgICAgKi9cbiAgICAgICAgdGhpcy5zZWxlY3RlZC5lbWl0KHtncm91cDoge2tleTogdGhpcy5ncm91cC5rZXl9LCBpdGVtOiBudWxsfSk7XG4gICAgfVxufVxuIl19