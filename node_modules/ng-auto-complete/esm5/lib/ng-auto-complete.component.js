/**
 * @fileoverview added by tsickle
 * @suppress {checkTypes,extraRequire,missingReturn,unusedPrivateMembers,uselessCode} checked by tsc
 */
import { ChangeDetectorRef, Component, ElementRef, EventEmitter, Input, Output, QueryList, ViewChild, ViewChildren } from '@angular/core';
import { CompleterComponent } from './completer/completer.component';
import { ReturnStringArrayByID } from './utils/utils';
import { Subject } from 'rxjs';
var NgAutoCompleteComponent = /** @class */ (function () {
    function NgAutoCompleteComponent(cdr) {
        this.cdr = cdr;
        this.selected = new EventEmitter();
        this.noResult = new EventEmitter();
        this.group = [];
        this.key = '';
        this.classes = [];
        this._viewHasBeenInit = false;
        this._viewInitSubject = new Subject();
    }
    /**
     * @param {?} changes
     * @return {?}
     */
    NgAutoCompleteComponent.prototype.ngOnChanges = /**
     * @param {?} changes
     * @return {?}
     */
    function (changes) {
    };
    /**
     *
     */
    /**
     *
     * @return {?}
     */
    NgAutoCompleteComponent.prototype.ngOnInit = /**
     *
     * @return {?}
     */
    function () {
    };
    /**
     *
     */
    /**
     *
     * @return {?}
     */
    NgAutoCompleteComponent.prototype.ngAfterViewChecked = /**
     *
     * @return {?}
     */
    function () {
        if (!this._viewHasBeenInit) {
            /** @type {?} */
            var el = this.init.nativeElement.querySelector('.after-view-init');
            if (window.getComputedStyle(el).length > 0) {
                this._viewHasBeenInit = true;
                this._viewInitSubject.next(true);
            }
        }
    };
    /**
     *
     */
    /**
     *
     * @param {?} selected
     * @return {?}
     */
    NgAutoCompleteComponent.prototype.ListenToSelected = /**
     *
     * @param {?} selected
     * @return {?}
     */
    function (selected) {
        this.selected.emit(selected);
        /**
         *
         */
        this.SetChildren(selected);
    };
    /**
     *
     */
    /**
     *
     * @param {?} group
     * @return {?}
     */
    NgAutoCompleteComponent.prototype.NoResult = /**
     *
     * @param {?} group
     * @return {?}
     */
    function (group) {
        this.noResult.emit(group);
    };
    /**
     *
     */
    /**
     *
     * @param {?} key
     * @return {?}
     */
    NgAutoCompleteComponent.prototype.InputCleared = /**
     *
     * @param {?} key
     * @return {?}
     */
    function (key) {
        var _this = this;
        this.group.forEach(function (group) {
            if (group.key === key || group.parent === key) {
                _this.ResetInput(group.key);
            }
        });
        /**
         * Items may have changed, need to te re-set list in completer components.
         */
        this.TriggerChange();
    };
    /**
     *
     */
    /**
     *
     * @param {?} selected
     * @return {?}
     */
    NgAutoCompleteComponent.prototype.SetChildren = /**
     *
     * @param {?} selected
     * @return {?}
     */
    function (selected) {
        var _this = this;
        this.group.forEach(function (item) {
            if (item.parent == selected.group.key) {
                _this.ResetInput(item.key);
                /**
                 *
                 */
                if (selected.item !== null && typeof selected.item.children !== 'undefined') {
                    item.SetNewValue(selected.item.children, selected.group.keys.titleKey);
                }
            }
        });
        /**
         * Items may have changed, need to te re-set list in completer components.
         */
        this.TriggerChange();
    };
    /**
     *
     */
    /**
     *
     * @return {?}
     */
    NgAutoCompleteComponent.prototype.TriggerChange = /**
     *
     * @return {?}
     */
    function () {
        this.completers.forEach(function (completer) {
            completer.SetItems();
        });
    };
    // =======================================================================//
    // ! Utils                                                                //
    // =======================================================================//
    /**
     *
     */
    // =======================================================================//
    // ! Utils                                                                //
    // =======================================================================//
    /**
     *
     * @param {?} key
     * @return {?}
     */
    NgAutoCompleteComponent.prototype.GetInput = 
    // =======================================================================//
    // ! Utils                                                                //
    // =======================================================================//
    /**
     *
     * @param {?} key
     * @return {?}
     */
    function (key) {
        return this.completers.reduce(function (result, completer) {
            if (completer.group.key === key) {
                result = completer;
            }
            return result;
        }, (/** @type {?} */ ({})));
    };
    /**
     *
     */
    /**
     *
     * @param {?} key
     * @param {?} f
     * @return {?}
     */
    NgAutoCompleteComponent.prototype.SubscribeInput = /**
     *
     * @param {?} key
     * @param {?} f
     * @return {?}
     */
    function (key, f) {
        var _this = this;
        if (this._viewHasBeenInit) {
            /** @type {?} */
            var completer = this.GetInput(key);
            /**
             *
             */
            f(completer);
            return;
        }
        this._viewInitSubject.subscribe(function (_bool) {
            /** @type {?} */
            var completer = _this.GetInput(key);
            setTimeout(function () {
                f(completer);
            });
            _this._viewInitSubject.unsubscribe();
        });
    };
    /**
     *
     */
    /**
     *
     * @param {?} key
     * @return {?}
     */
    NgAutoCompleteComponent.prototype.ResetInput = /**
     *
     * @param {?} key
     * @return {?}
     */
    function (key) {
        this.SubscribeInput(key, function (completer) {
            completer.ClearValue();
        });
    };
    /**
     *
     */
    /**
     *
     * @param {?} key
     * @param {?} values
     * @return {?}
     */
    NgAutoCompleteComponent.prototype.SetValues = /**
     *
     * @param {?} key
     * @param {?} values
     * @return {?}
     */
    function (key, values) {
        var _this = this;
        this.SubscribeInput(key, function (completer) {
            completer.group.SetValues(values);
            /**
             * Items may have changed, need to te re-set list in completer components.
             */
            _this.TriggerChange();
        });
    };
    /**
     *
     */
    /**
     *
     * @param {?} key
     * @param {?} type
     * @param {?} template
     * @return {?}
     */
    NgAutoCompleteComponent.prototype.SetTemplate = /**
     *
     * @param {?} key
     * @param {?} type
     * @param {?} template
     * @return {?}
     */
    function (key, type, template) {
        var _this = this;
        this.SubscribeInput(key, function (completer) {
            completer.group[type] = template;
            /**
             * Items may have changed, need to te re-set list in completer components.
             */
            _this.TriggerChange();
        });
    };
    /**
     *
     */
    /**
     *
     * @param {?} key
     * @param {?} promise
     * @return {?}
     */
    NgAutoCompleteComponent.prototype.SetAsync = /**
     *
     * @param {?} key
     * @param {?} promise
     * @return {?}
     */
    function (key, promise) {
        var _this = this;
        this.SubscribeInput(key, function (completer) {
            completer.group.async = promise;
            /**
             * Items may have changed, need to te re-set list in completer components.
             */
            _this.TriggerChange();
        });
    };
    /**
     *
     */
    /**
     *
     * @param {?} key
     * @return {?}
     */
    NgAutoCompleteComponent.prototype.SetEnable = /**
     *
     * @param {?} key
     * @return {?}
     */
    function (key) {
        var _this = this;
        this.SubscribeInput(key, function (completer) {
            completer._disabled = false;
            /**
             * Items may have changed, need to te re-set list in completer components.
             */
            _this.TriggerChange();
        });
    };
    /**
     *
     */
    /**
     *
     * @param {?} key
     * @return {?}
     */
    NgAutoCompleteComponent.prototype.SetDisable = /**
     *
     * @param {?} key
     * @return {?}
     */
    function (key) {
        var _this = this;
        this.SubscribeInput(key, function (completer) {
            completer._disabled = true;
            /**
             * Items may have changed, need to te re-set list in completer components.
             */
            _this.TriggerChange();
        });
    };
    /**
     *
     */
    /**
     *
     * @param {?} key
     * @param {?} id
     * @return {?}
     */
    NgAutoCompleteComponent.prototype.SelectItem = /**
     *
     * @param {?} key
     * @param {?} id
     * @return {?}
     */
    function (key, id) {
        this.SubscribeInput(key, function (completer) {
            Object.keys(completer._items).forEach(function (key) {
                /** @type {?} */
                var f = "_id_" + String(id);
                /** @type {?} */
                var c = key.substring(key.indexOf(f), key.length);
                if (f === c) {
                    completer.SelectItem(completer._items[key]);
                }
            });
        });
    };
    /**
     *
     */
    /**
     *
     * @param {?} key
     * @param {?} ids
     * @return {?}
     */
    NgAutoCompleteComponent.prototype.RemovableValues = /**
     *
     * @param {?} key
     * @param {?} ids
     * @return {?}
     */
    function (key, ids) {
        var _this = this;
        this.SubscribeInput(key, function (completer) {
            completer.group.Removables(ReturnStringArrayByID(ids));
            /**
             * Items may have changed, need to te re-set list in completer components.
             */
            _this.TriggerChange();
        });
    };
    /**
     *
     */
    /**
     *
     * @return {?}
     */
    NgAutoCompleteComponent.prototype.ResetInputs = /**
     *
     * @return {?}
     */
    function () {
        var _this = this;
        this.group.forEach(function (item) {
            _this.ResetInput(item.key);
        });
    };
    // =======================================================================//
    // ! Static (utils)                                                       //
    // =======================================================================//
    /**
     *
     */
    // =======================================================================//
    // ! Static (utils)                                                       //
    // =======================================================================//
    /**
     *
     * @param {?} key
     * @param {?} list
     * @return {?}
     */
    NgAutoCompleteComponent.FindCompleter = 
    // =======================================================================//
    // ! Static (utils)                                                       //
    // =======================================================================//
    /**
     *
     * @param {?} key
     * @param {?} list
     * @return {?}
     */
    function (key, list) {
        /** @type {?} */
        var completer = list.filter(function (completer) {
            return key === completer.key;
        });
        if (typeof completer[0] !== 'undefined') {
            return completer[0];
        }
        return null;
    };
    NgAutoCompleteComponent.decorators = [
        { type: Component, args: [{
                    selector: 'ng-auto-complete',
                    template: "\n        <div #init style=\"display: none;\"><span class=\"after-view-init\"></span></div>\n        <ng-completer [ngClass]=\"classes\" *ngFor=\"let item of group\" (cleared)=\"InputCleared($event)\"\n                      (no-result)=\"NoResult($event)\"\n                      (selected)=\"ListenToSelected($event)\"\n                      [group]=\"item\"></ng-completer>\n    "
                }] }
    ];
    /** @nocollapse */
    NgAutoCompleteComponent.ctorParameters = function () { return [
        { type: ChangeDetectorRef }
    ]; };
    NgAutoCompleteComponent.propDecorators = {
        completers: [{ type: ViewChildren, args: [CompleterComponent,] }],
        init: [{ type: ViewChild, args: ['init',] }],
        selected: [{ type: Output }],
        noResult: [{ type: Output, args: ['no-result',] }],
        group: [{ type: Input }],
        key: [{ type: Input }],
        classes: [{ type: Input }]
    };
    return NgAutoCompleteComponent;
}());
export { NgAutoCompleteComponent };
if (false) {
    /** @type {?} */
    NgAutoCompleteComponent.prototype.completers;
    /** @type {?} */
    NgAutoCompleteComponent.prototype.init;
    /** @type {?} */
    NgAutoCompleteComponent.prototype.selected;
    /** @type {?} */
    NgAutoCompleteComponent.prototype.noResult;
    /** @type {?} */
    NgAutoCompleteComponent.prototype.group;
    /** @type {?} */
    NgAutoCompleteComponent.prototype.key;
    /** @type {?} */
    NgAutoCompleteComponent.prototype.classes;
    /** @type {?} */
    NgAutoCompleteComponent.prototype._viewHasBeenInit;
    /** @type {?} */
    NgAutoCompleteComponent.prototype._viewInitSubject;
    /**
     * @type {?}
     * @private
     */
    NgAutoCompleteComponent.prototype.cdr;
}
//# sourceMappingURL=data:application/json;base64,eyJ2ZXJzaW9uIjozLCJmaWxlIjoibmctYXV0by1jb21wbGV0ZS5jb21wb25lbnQuanMiLCJzb3VyY2VSb290Ijoibmc6Ly9uZy1hdXRvLWNvbXBsZXRlLyIsInNvdXJjZXMiOlsibGliL25nLWF1dG8tY29tcGxldGUuY29tcG9uZW50LnRzIl0sIm5hbWVzIjpbXSwibWFwcGluZ3MiOiI7Ozs7QUFBQSxPQUFPLEVBQ0gsaUJBQWlCLEVBQ2pCLFNBQVMsRUFDVCxVQUFVLEVBQ1YsWUFBWSxFQUNaLEtBQUssRUFFTCxNQUFNLEVBQ04sU0FBUyxFQUdULFNBQVMsRUFDVCxZQUFZLEVBQ2YsTUFBTSxlQUFlLENBQUM7QUFHdkIsT0FBTyxFQUFDLGtCQUFrQixFQUFDLE1BQU0saUNBQWlDLENBQUM7QUFDbkUsT0FBTyxFQUFnQixxQkFBcUIsRUFBQyxNQUFNLGVBQWUsQ0FBQztBQUNuRSxPQUFPLEVBQUMsT0FBTyxFQUFDLE1BQU0sTUFBTSxDQUFDO0FBRTdCO0lBd0JJLGlDQUFvQixHQUFzQjtRQUF0QixRQUFHLEdBQUgsR0FBRyxDQUFtQjtRQVZ6QixhQUFRLEdBQTJDLElBQUksWUFBWSxFQUE0QixDQUFDO1FBQ3JGLGFBQVEsR0FBZ0MsSUFBSSxZQUFZLEVBQWlCLENBQUM7UUFFdEYsVUFBSyxHQUF3QixFQUFFLENBQUM7UUFDaEMsUUFBRyxHQUFXLEVBQUUsQ0FBQztRQUNqQixZQUFPLEdBQWEsRUFBRSxDQUFDO1FBRXZDLHFCQUFnQixHQUFZLEtBQUssQ0FBQztRQUNsQyxxQkFBZ0IsR0FBcUIsSUFBSSxPQUFPLEVBQVcsQ0FBQztJQUc1RCxDQUFDOzs7OztJQUVELDZDQUFXOzs7O0lBQVgsVUFBWSxPQUFzQjtJQUVsQyxDQUFDO0lBRUQ7O09BRUc7Ozs7O0lBQ0gsMENBQVE7Ozs7SUFBUjtJQUNBLENBQUM7SUFFRDs7T0FFRzs7Ozs7SUFDSCxvREFBa0I7Ozs7SUFBbEI7UUFDSSxJQUFJLENBQUMsSUFBSSxDQUFDLGdCQUFnQixFQUFFOztnQkFDcEIsRUFBRSxHQUFHLElBQUksQ0FBQyxJQUFJLENB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WUFDaEUsU0FBUyxHQUFHLElBQUksQ0FBQyxNQUFNLENBQUMsVUFBQyxTQUFrQztZQUM3RCxPQUFPLEdBQUcsS0FBSyxTQUFTLENBQUMsR0FBRyxDQUFDO1FBQ2pDLENBQUMsQ0FBQztRQUVGLElBQUksT0FBTyxTQUFTLENBQUMsQ0FBQyxDQUFDLEtBQUssV0FBVyxFQUFFO1lBQ3JDLE9BQU8sU0FBUyxDQUFDLENBQUMsQ0FBQyxDQUFDO1NBQ3ZCO1FBRUQsT0FBTyxJQUFJLENBQUM7SUFDaEIsQ0FBQzs7Z0JBaFVKLFNBQVMsU0FBQztvQkFDUCxRQUFRLEVBQUUsa0JBQWtCO29CQUM1QixRQUFRLEVBQUUsK1hBTVQ7aUJBQ0o7Ozs7Z0JBNUJHLGlCQUFpQjs7OzZCQThCaEIsWUFBWSxTQUFDLGtCQUFrQjt1QkFDL0IsU0FBUyxTQUFDLE1BQU07MkJBRWhCLE1BQU07MkJBQ04sTUFBTSxTQUFDLFdBQVc7d0JBRWxCLEtBQUs7c0JBQ0wsS0FBSzswQkFDTCxLQUFLOztJQThTViw4QkFBQztDQUFBLEFBalVELElBaVVDO1NBdlRZLHVCQUF1Qjs7O0lBQ2hDLDZDQUFtRjs7SUFDbkYsdUNBQTJDOztJQUUzQywyQ0FBaUg7O0lBQ2pILDJDQUFzRzs7SUFFdEcsd0NBQWdEOztJQUNoRCxzQ0FBaUM7O0lBQ2pDLDBDQUF1Qzs7SUFFdkMsbURBQWtDOztJQUNsQyxtREFBNEQ7Ozs7O0lBRWhELHNDQUE4QiIsInNvdXJjZXNDb250ZW50IjpbImltcG9ydCB7XG4gICAgQ2hhbmdlRGV0ZWN0b3JSZWYsXG4gICAgQ29tcG9uZW50LFxuICAgIEVsZW1lbnRSZWYsXG4gICAgRXZlbnRFbWl0dGVyLFxuICAgIElucHV0LFxuICAgIE9uSW5pdCxcbiAgICBPdXRwdXQsXG4gICAgUXVlcnlMaXN0LFxuICAgIFNpbXBsZUNoYW5nZXMsXG4gICAgVGVtcGxhdGVSZWYsXG4gICAgVmlld0NoaWxkLFxuICAgIFZpZXdDaGlsZHJlblxufSBmcm9tICdAYW5ndWxhci9jb3JlJztcbmltcG9ydCB7QXV0b2NvbXBsZXRlR3JvdXB9IGZyb20gJy4vY2xhc3Nlcy9BdXRvY29tcGxldGVHcm91cCc7XG5pbXBvcnQge1NlbGVjdGVkQXV0b2NvbXBsZXRlSXRlbX0gZnJvbSAnLi9jbGFzc2VzL3R5cGluZyc7XG5pbXBvcnQge0NvbXBsZXRlckNvbXBvbmVudH0gZnJvbSAnLi9jb21wbGV0ZXIvY29tcGxldGVyLmNvbXBvbmVudCc7XG5pbXBvcnQge0dyb3VwTm9SZXN1bHQsIFJldHVyblN0cmluZ0FycmF5QnlJRH0gZnJvbSAnLi91dGlscy91dGlscyc7XG5pbXBvcnQge1N1YmplY3R9IGZyb20gJ3J4anMnO1xuXG5AQ29tcG9uZW50KHtcbiAgICBzZWxlY3RvcjogJ25nLWF1dG8tY29tcGxldGUnLFxuICAgIHRlbXBsYXRlOiBgXG4gICAgICAgIDxkaXYgI2luaXQgc3R5bGU9XCJkaXNwbGF5OiBub25lO1wiPjxzcGFuIGNsYXNzPVwiYWZ0ZXItdmlldy1pbml0XCI+PC9zcGFuPjwvZGl2PlxuICAgICAgICA8bmctY29tcGxldGVyIFtuZ0NsYXNzXT1cImNsYXNzZXNcIiAqbmdGb3I9XCJsZXQgaXRlbSBvZiBncm91cFwiIChjbGVhcmVkKT1cIklucHV0Q2xlYXJlZCgkZXZlbnQpXCJcbiAgICAgICAgICAgICAgICAgICAgICAobm8tcmVzdWx0KT1cIk5vUmVzdWx0KCRldmVudClcIlxuICAgICAgICAgICAgICAgICAgICAgIChzZWxlY3RlZCk9XCJMaXN0ZW5Ub1NlbGVjdGVkKCRldmVudClcIlxuICAgICAgICAgICAgICAgICAgICAgIFtncm91cF09XCJpdGVtXCI+PC9uZy1jb21wbGV0ZXI+XG4gICAgYCxcbn0pXG5leHBvcnQgY2xhc3MgTmdBdXRvQ29tcGxldGVDb21wb25lbnQgaW1wbGVtZW50cyBPbkluaXQge1xuICAgIEBWaWV3Q2hpbGRyZW4oQ29tcGxldGVyQ29tcG9uZW50KSBwdWJsaWMgY29tcGxldGVyczogUXVlcnlMaXN0PENvbXBsZXRlckNvbXBvbmVudD47XG4gICAgQFZpZXdDaGlsZCgnaW5pdCcpIHB1YmxpYyBpbml0OiBFbGVtZW50UmVmO1xuXG4gICAgQE91dHB1dCgpIHB1YmxpYyBzZWxlY3RlZDogRXZlbnRFbWl0dGVyPFNlbGVjdGVkQXV0b2NvbXBsZXRlSXRlbT4gPSBuZXcgRXZlbnRFbWl0dGVyPFNlbGVjdGVkQXV0b2NvbXBsZXRlSXRlbT4oKTtcbiAgICBAT3V0cHV0KCduby1yZXN1bHQnKSBwdWJsaWMgbm9SZXN1bHQ6IEV2ZW50RW1pdHRlcjxHcm91cE5vUmVzdWx0PiA9IG5ldyBFdmVudEVtaXR0ZXI8R3JvdXBOb1Jlc3VsdD4oKTtcblxuICAgIEBJbnB1dCgpIHB1YmxpYyBncm91cDogQXV0b2NvbXBsZXRlR3JvdXBbXSA9IFtdO1xuICAgIEBJbnB1dCgpIHB1YmxpYyBrZXk6IHN0cmluZyA9ICcnO1xuICAgIEBJbnB1dCgpIHB1YmxpYyBjbGFzc2VzOiBzdHJpbmdbXSA9IFtdO1xuXG4gICAgX3ZpZXdIYXNCZWVuSW5pdDogYm9vbGVhbiA9IGZhbHNlO1xuICAgIF92aWV3SW5pdFN1YmplY3Q6IFN1YmplY3Q8Ym9vbGVhbj4gPSBuZXcgU3ViamVjdDxib29sZWFuPigpO1xuXG4gICAgY29uc3RydWN0b3IocHJpdmF0ZSBjZHI6IENoYW5nZURldGVjdG9yUmVmKSB7XG4gICAgfVxuXG4gICAgbmdPbkNoYW5nZXMoY2hhbmdlczogU2ltcGxlQ2hhbmdlcykge1xuXG4gICAgfVxuXG4gICAgLyoqXG4gICAgICpcbiAgICAgKi9cbiAgICBuZ09uSW5pdCgpIHtcbiAgICB9XG5cbiAgICAvKipcbiAgICAgKlxuICAgICAqL1xuICAgIG5nQWZ0ZXJWaWV3Q2hlY2tlZCgpIHtcbiAgICAgICAgaWYgKCF0aGlzLl92aWV3SGFzQmVlbkluaXQpIHtcbiAgICAgICAgICAgIGxldCBlbCA9IHRoaXMuaW5pdC5uYXRpdmVFbGVtZW50LnF1ZXJ5U2VsZWN0b3IoJy5hZnRlci12aWV3LWluaXQnKTtcblxuICAgICAgICAgICAgaWYgKHdpbmRvdy5nZXRDb21wdXRlZFN0eWxlKGVsKS5sZW5ndGggPiAwKSB7XG4gICAgICAgICAgICAgICAgdGhpcy5fdmlld0hhc0JlZW5Jbml0ID0gdHJ1ZTtcbiAgICAgICAgICAgICAgICB0aGlzLl92aWV3SW5pdFN1YmplY3QubmV4dCh0cnVlKTtcbiAgICAgICAgICAgIH1cbiAgICAgICAgfVxuICAgIH1cblxuICAgIC8qKlxuICAgICAqXG4gICAgICovXG4gICAgTGlzdGVuVG9TZWxlY3RlZChzZWxlY3RlZDogU2VsZWN0ZWRBdXRvY29tcGxldGVJdGVtKSB7XG4gICAgICAgIHRoaXMuc2VsZWN0ZWQuZW1pdChzZWxlY3RlZCk7XG5cbiAgICAgICAgLyoqXG4gICAgICAgICAqXG4gICAgICAgICAqL1xuICAgICAgICB0aGlzLlNldENoaWxkcmVuKHNlbGVjdGVkKTtcbiAgICB9XG5cbiAgICAvKipcbiAgICAgKlxuICAgICAqL1xuICAgIE5vUmVzdWx0KGdyb3VwOiBHcm91cE5vUmVzdWx0KSB7XG4gICAgICAgIHRoaXMubm9SZXN1bHQuZW1pdChncm91cCk7XG4gICAgfVxuXG4gICAgLyoqXG4gICAgICpcbiAgICAgKi9cbiAgICBJbnB1dENsZWFyZWQoa2V5OiBzdHJpbmcpIHtcbiAgICAgICAgdGhpcy5ncm91cC5mb3JFYWNoKChncm91cCkgPT4ge1xuICAgICAgICAgICAgaWYgKGdyb3VwLmtleSA9PT0ga2V5IHx8IGdyb3VwLnBhcmVudCA9PT0ga2V5KSB7XG4gICAgICAgICAgICAgICAgdGhpcy5SZXNldElucHV0KGdyb3VwLmtleSk7XG4gICAgICAgICAgICB9XG4gICAgICAgIH0pO1xuXG4gICAgICAgIC8qKlxuICAgICAgICAgKiBJdGVtcyBtYXkgaGF2ZSBjaGFuZ2VkLCBuZWVkIHRvIHRlIHJlLXNldCBsaXN0IGluIGNvbXBsZXRlciBjb21wb25lbnRzLlxuICAgICAgICAgKi9cbiAgICAgICAgdGhpcy5UcmlnZ2VyQ2hhbmdlKCk7XG4gICAgfVxuXG4gICAgLyoqXG4gICAgICpcbiAgICAgKi9cbiAgICBTZXRDaGlsZHJlbihzZWxlY3RlZDogU2VsZWN0ZWRBdXRvY29tcGxldGVJdGVtKSB7XG4gICAgICAgIHRoaXMuZ3JvdXAuZm9yRWFjaCgoaXRlbSkgPT4ge1xuXG4gICAgICAgICAgICBpZiAoaXRlbS5wYXJlbnQgPT0gc2VsZWN0ZWQuZ3JvdXAua2V5KSB7XG4gICAgICAgICAgICAgICAgdGhpcy5SZXNldElucHV0KGl0ZW0ua2V5KTtcblxuICAgICAgICAgICAgICAgIC8qKlxuICAgICAgICAgICAgICAgICAqXG4gICAgICAgICAgICAgICAgICovXG4gICAgICAgICAgICAgICAgaWYgKHNlbGVjdGVkLml0ZW0gIT09IG51bGwgJiYgdHlwZW9mIHNlbGVjdGVkLml0ZW0uY2hpbGRyZW4gIT09ICd1bmRlZmluZWQnKSB7XG4gICAgICAgICAgICAgICAgICAgIGl0ZW0uU2V0TmV3VmFsdWUoc2VsZWN0ZWQuaXRlbS5jaGlsZHJlbiwgc2VsZWN0ZWQuZ3JvdXAua2V5cy50aXRsZUtleSk7XG4gICAgICAgICAgICAgICAgfVxuICAgICAgICAgICAgfVxuICAgICAgICB9KTtcblxuICAgICAgICAvKipcbiAgICAgICAgICogSXRlbXMgbWF5IGhhdmUgY2hhbmdlZCwgbmVlZCB0byB0ZSByZS1zZXQgbGlzdCBpbiBjb21wbGV0ZXIgY29tcG9uZW50cy5cbiAgICAgICAgICovXG4gICAgICAgIHRoaXMuVHJpZ2dlckNoYW5nZSgpO1xuICAgIH1cblxuICAgIC8qKlxuICAgICAqXG4gICAgICovXG4gICAgVHJpZ2dlckNoYW5nZSgpIHtcbiAgICAgICAgdGhpcy5jb21wbGV0ZXJzLmZvckVhY2goKGNvbXBsZXRlcikgPT4ge1xuICAgICAgICAgICAgY29tcGxldGVyLlNldEl0ZW1zKCk7XG4gICAgICAgIH0pO1xuICAgIH1cblxuICAgIC8vID09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09Ly9cbiAgICAvLyAhIFV0aWxzICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgIC8vXG4gICAgLy8gPT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT0vL1xuXG4gICAgLyoqXG4gICAgICpcbiAgICAgKi9cbiAgICBHZXRJbnB1dChrZXk6IHN0cmluZyk6IENvbXBsZXRlckNvbXBvbmVudCB7XG4gICAgICAgIHJldHVybiB0aGlzLmNvbXBsZXRlcnMucmVkdWNlKChyZXN1bHQsIGNvbXBsZXRlcikgPT4ge1xuICAgICAgICAgICAgaWYgKGNvbXBsZXRlci5ncm91cC5rZXkgPT09IGtleSkge1xuICAgICAgICAgICAgICAgIHJlc3VsdCA9IGNvbXBsZXRlcjtcbiAgICAgICAgICAgIH1cblxuICAgICAgICAgICAgcmV0dXJuIHJlc3VsdDtcbiAgICAgICAgfSwgPENvbXBsZXRlckNvbXBvbmVudD57fSk7XG4gICAgfVxuXG4gICAgLyoqXG4gICAgICpcbiAgICAgKi9cbiAgICBTdWJzY3JpYmVJbnB1dChrZXk6IHN0cmluZywgZjogKGNvbXBsZXRlcjogQ29tcGxldGVyQ29tcG9uZW50KSA9PiB2b2lkKSB7XG4gICAgICAgIGlmICh0aGlzLl92aWV3SGFzQmVlbkluaXQpIHtcbiAgICAgICAgICAgIGxldCBjb21wbGV0ZXIgPSB0aGlzLkdldElucHV0KGtleSk7XG5cbiAgICAgICAgICAgIC8qKlxuICAgICAgICAgICAgICpcbiAgICAgICAgICAgICAqL1xuICAgICAgICAgICAgZihjb21wbGV0ZXIpO1xuICAgICAgICAgICAgcmV0dXJuO1xuICAgICAgICB9XG5cbiAgICAgICAgdGhpcy5fdmlld0luaXRTdWJqZWN0LnN1YnNjcmliZSgoX2Jvb2wpID0+IHtcbiAgICAgICAgICAgIGxldCBjb21wbGV0ZXIgPSB0aGlzLkdldElucHV0KGtleSk7XG4gICAgICAgICAgICBzZXRUaW1lb3V0KCgpID0+IHtcbiAgICAgICAgICAgICAgICBmKGNvbXBsZXRlcik7XG4gICAgICAgICAgICB9KTtcblxuICAgICAgICAgICAgdGhpcy5fdmlld0luaXRTdWJqZWN0LnVuc3Vic2NyaWJlKCk7XG4gICAgICAgIH0pO1xuICAgIH1cblxuICAgIC8qKlxuICAgICAqXG4gICAgICovXG4gICAgUmVzZXRJbnB1dChrZXk6IHN0cmluZykge1xuICAgICAgICB0aGlzLlN1YnNjcmliZUlucHV0KFxuICAgICAgICAgICAga2V5LFxuICAgICAgICAgICAgKGNvbXBsZXRlcikgPT4ge1xuICAgICAgICAgICAgICAgIGNvbXBsZXRlci5DbGVhclZhbHVlKCk7XG4gICAgICAgICAgICB9XG4gICAgICAgICk7XG4gICAgfVxuXG4gICAgLyoqXG4gICAgICpcbiAgICAgKi9cbiAgICBTZXRWYWx1ZXMoa2V5OiBzdHJpbmcsIHZhbHVlczogeyBpZD86IHN0cmluZyB8IG51bWJlcjsgW3ZhbHVlOiBzdHJpbmddOiBhbnkgfVtdKSB7XG4gICAgICAgIHRoaXMuU3Vic2NyaWJlSW5wdXQoXG4gICAgICAgICAgICBrZXksXG4gICAgICAgICAgICAoY29tcGxldGVyKSA9PiB7XG4gICAgICAgICAgICAgICAgY29tcGxldGVyLmdyb3VwLlNldFZhbHVlcyh2YWx1ZXMpO1xuXG4gICAgICAgICAgICAgICAgLyoqXG4gICAgICAgICAgICAgICAgICogSXRlbXMgbWF5IGhhdmUgY2hhbmdlZCwgbmVlZCB0byB0ZSByZS1zZXQgbGlzdCBpbiBjb21wbGV0ZXIgY29tcG9uZW50cy5cbiAgICAgICAgICAgICAgICAgKi9cbiAgICAgICAgICAgICAgICB0aGlzLlRyaWdnZXJDaGFuZ2UoKTtcbiAgICAgICAgICAgIH1cbiAgICAgICAgKTtcbiAgICB9XG5cbiAgICAvKipcbiAgICAgKlxuICAgICAqL1xuICAgIFNldFRlbXBsYXRlKGtleTogc3RyaW5nLCB0eXBlOiAnbm9SZXN1bHRzJyB8ICdwbGFjZWhvbGRlclZhbHVlJyB8ICdkcm9wZG93blZhbHVlJywgdGVtcGxhdGU6IFRlbXBsYXRlUmVmPGFueT4pIHtcbiAgICAgICAgdGhpcy5TdWJzY3JpYmVJbnB1dChcbiAgICAgICAgICAgIGtleSxcbiAgICAgICAgICAgIChjb21wbGV0ZXIpID0+IHtcbiAgICAgICAgICAgICAgICBjb21wbGV0ZXIuZ3JvdXBbdHlwZV0gPSB0ZW1wbGF0ZTtcblxuICAgICAgICAgICAgICAgIC8qKlxuICAgICAgICAgICAgICAgICAqIEl0ZW1zIG1heSBoYXZlIGNoYW5nZWQsIG5lZWQgdG8gdGUgcmUtc2V0IGxpc3QgaW4gY29tcGxldGVyIGNvbXBvbmVudHMuXG4gICAgICAgICAgICAgICAgICovXG4gICAgICAgICAgICAgICAgdGhpcy5UcmlnZ2VyQ2hhbmdlKCk7XG4gICAgICAgICAgICB9XG4gICAgICAgICk7XG4gICAgfVxuXG4gICAgLyoqXG4gICAgICpcbiAgICAgKi9cbiAgICBTZXRBc3luYyhrZXk6IHN0cmluZywgcHJvbWlzZTogKHN0cjogc3RyaW5nKSA9PiBQcm9taXNlPHsgaWQ6IHN0cmluZyB8IG51bWJlcjsgW3ZhbHVlOiBzdHJpbmddOiBhbnkgfVtdPikge1xuICAgICAgICB0aGlzLlN1YnNjcmliZUlucHV0KFxuICAgICAgICAgICAga2V5LFxuICAgICAgICAgICAgKGNvbXBsZXRlcikgPT4ge1xuICAgICAgICAgICAgICAgIGNvbXBsZXRlci5ncm91cC5hc3luYyA9IHByb21pc2U7XG5cbiAgICAgICAgICAgICAgICAvKipcbiAgICAgICAgICAgICAgICAgKiBJdGVtcyBtYXkgaGF2ZSBjaGFuZ2VkLCBuZWVkIHRvIHRlIHJlLXNldCBsaXN0IGluIGNvbXBsZXRlciBjb21wb25lbnRzLlxuICAgICAgICAgICAgICAgICAqL1xuICAgICAgICAgICAgICAgIHRoaXMuVHJpZ2dlckNoYW5nZSgpO1xuICAgICAgICAgICAgfVxuICAgICAgICApO1xuICAgIH1cblxuICAgIC8qKlxuICAgICAqXG4gICAgICovXG4gICAgU2V0RW5hYmxlKGtleTogc3RyaW5nKSB7XG4gICAgICAgIHRoaXMuU3Vic2NyaWJlSW5wdXQoXG4gICAgICAgICAgICBrZXksXG4gICAgICAgICAgICAoY29tcGxldGVyKSA9PiB7XG4gICAgICAgICAgICAgICAgY29tcGxldGVyLl9kaXNhYmxlZCA9IGZhbHNlO1xuXG4gICAgICAgICAgICAgICAgLyoqXG4gICAgICAgICAgICAgICAgICogSXRlbXMgbWF5IGhhdmUgY2hhbmdlZCwgbmVlZCB0byB0ZSByZS1zZXQgbGlzdCBpbiBjb21wbGV0ZXIgY29tcG9uZW50cy5cbiAgICAgICAgICAgICAgICAgKi9cbiAgICAgICAgICAgICAgICB0aGlzLlRyaWdnZXJDaGFuZ2UoKTtcbiAgICAgICAgICAgIH1cbiAgICAgICAgKTtcbiAgICB9XG5cbiAgICAvKipcbiAgICAgKlxuICAgICAqL1xuICAgIFNldERpc2FibGUoa2V5OiBzdHJpbmcpIHtcbiAgICAgICAgdGhpcy5TdWJzY3JpYmVJbnB1dChcbiAgICAgICAgICAgIGtleSxcbiAgICAgICAgICAgIChjb21wbGV0ZXIpID0+IHtcbiAgICAgICAgICAgICAgICBjb21wbGV0ZXIuX2Rpc2FibGVkID0gdHJ1ZTtcblxuICAgICAgICAgICAgICAgIC8qKlxuICAgICAgICAgICAgICAgICAqIEl0ZW1zIG1heSBoYXZlIGNoYW5nZWQsIG5lZWQgdG8gdGUgcmUtc2V0IGxpc3QgaW4gY29tcGxldGVyIGNvbXBvbmVudHMuXG4gICAgICAgICAgICAgICAgICovXG4gICAgICAgICAgICAgICAgdGhpcy5UcmlnZ2VyQ2hhbmdlKCk7XG4gICAgICAgICAgICB9XG4gICAgICAgICk7XG4gICAgfVxuXG4gICAgLyoqXG4gICAgICpcbiAgICAgKi9cbiAgICBTZWxlY3RJdGVtKGtleTogc3RyaW5nLCBpZDogc3RyaW5nIHwgbnVtYmVyKSB7XG4gICAgICAgIHRoaXMuU3Vic2NyaWJlSW5wdXQoXG4gICAgICAgICAgICBrZXksXG4gICAgICAgICAgICAoY29tcGxldGVyKSA9PiB7XG4gICAgICAgICAgICAgICAgT2JqZWN0LmtleXMoY29tcGxldGVyLl9pdGVtcykuZm9yRWFjaCgoa2V5KSA9PiB7XG4gICAgICAgICAgICAgICAgICAgIGxldCBmID0gYF9pZF8ke1N0cmluZyhpZCl9YDtcbiAgICAgICAgICAgICAgICAgICAgbGV0IGMgPSBrZXkuc3Vic3RyaW5nKGtleS5pbmRleE9mKGYpLCBrZXkubGVuZ3RoKTtcblxuICAgICAgICAgICAgICAgICAgICBpZiAoZiA9PT0gYykge1xuICAgICAgICAgICAgICAgICAgICAgICAgY29tcGxldGVyLlNlbGVjdEl0ZW0oY29tcGxldGVyLl9pdGVtc1trZXldKTtcbiAgICAgICAgICAgICAgICAgICAgfVxuICAgICAgICAgICAgICAgIH0pO1xuXG4gICAgICAgICAgICB9XG4gICAgICAgICk7XG4gICAgfVxuXG4gICAgLyoqXG4gICAgICpcbiAgICAgKi9cbiAgICBSZW1vdmFibGVWYWx1ZXMoa2V5OiBzdHJpbmcsIGlkczogeyBpZDogc3RyaW5nIHwgbnVtYmVyLCBbdmFsdWU6IHN0cmluZ106IGFueSB9W10pIHtcbiAgICAgICAgdGhpcy5TdWJzY3JpYmVJbnB1dChcbiAgICAgICAgICAgIGtleSxcbiAgICAgICAgICAgIChjb21wbGV0ZXIpID0+IHtcbiAgICAgICAgICAgICAgICBjb21wbGV0ZXIuZ3JvdXAuUmVtb3ZhYmxlcyhSZXR1cm5TdHJpbmdBcnJheUJ5SUQoaWRzKSk7XG5cbiAgICAgICAgICAgICAgICAvKipcbiAgICAgICAgICAgICAgICAgKiBJdGVtcyBtYXkgaGF2ZSBjaGFuZ2VkLCBuZWVkIHRvIHRlIHJlLXNldCBsaXN0IGluIGNvbXBsZXRlciBjb21wb25lbnRzLlxuICAgICAgICAgICAgICAgICAqL1xuICAgICAgICAgICAgICAgIHRoaXMuVHJpZ2dlckNoYW5nZSgpO1xuICAgICAgICAgICAgfVxuICAgICAgICApO1xuICAgIH1cblxuICAgIC8qKlxuICAgICAqXG4gICAgICovXG4gICAgUmVzZXRJbnB1dHMoKSB7XG4gICAgICAgIHRoaXMuZ3JvdXAuZm9yRWFjaCgoaXRlbSkgPT4ge1xuICAgICAgICAgICAgdGhpcy5SZXNldElucHV0KGl0ZW0ua2V5KTtcbiAgICAgICAgfSk7XG4gICAgfVxuXG4gICAgLy8gPT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT0vL1xuICAgIC8vICEgU3RhdGljICh1dGlscykgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgLy9cbiAgICAvLyA9PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PS8vXG5cbiAgICAvKipcbiAgICAgKlxuICAgICAqL1xuICAgIHN0YXRpYyBGaW5kQ29tcGxldGVyKGtleTogc3RyaW5nLCBsaXN0OiBRdWVyeUxpc3Q8TmdBdXRvQ29tcGxldGVDb21wb25lbnQ+KTogTmdBdXRvQ29tcGxldGVDb21wb25lbnQge1xuICAgICAgICBjb25zdCBjb21wbGV0ZXIgPSBsaXN0LmZpbHRlcigoY29tcGxldGVyOiBOZ0F1dG9Db21wbGV0ZUNvbXBvbmVudCkgPT4ge1xuICAgICAgICAgICAgcmV0dXJuIGtleSA9PT0gY29tcGxldGVyLmtleTtcbiAgICAgICAgfSk7XG5cbiAgICAgICAgaWYgKHR5cGVvZiBjb21wbGV0ZXJbMF0gIT09ICd1bmRlZmluZWQnKSB7XG4gICAgICAgICAgICByZXR1cm4gY29tcGxldGVyWzBdO1xuICAgICAgICB9XG5cbiAgICAgICAgcmV0dXJuIG51bGw7XG4gICAgfVxufVxuIl19